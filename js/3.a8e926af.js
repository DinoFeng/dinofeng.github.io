(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[3],{"3acf":function(e,t,a){},b59b:function(e,t,a){"use strict";a("3acf")},e344:function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("q-page",{staticClass:"flex flex-center"},[a("div",{staticClass:"sr__scan__item"},[e.scanFlag?a("video",{ref:"scannerRef",attrs:{id:"video","webkit-playsinline":"true",playsinline:"true"}}):e._e(),e.canSupport?a("q-btn-group",[a("q-btn",{on:{click:e.doScan}},[e._v("Start Scan")]),a("q-btn",{on:{click:e.stopScan}},[e._v("Stop Scan")]),e.videoDevices.length>1?a("q-btn",{on:{click:e.switchCamera}},[e._v("Switch")]):e._e()],1):e._e(),a("textarea",{attrs:{cols:100,rows:6},domProps:{value:e.info}})],1)])},i=[],n=(a("e01a"),a("224f")),c=a("b178"),o=a("1344"),r=Object(o["a"])();const d=Symbol("privateObj");class h{constructor(e,t={scanVoice:"scan.mp3"}){const{scanVoice:a}=t,s=new Audio(a),i=new n["BrowserMultiFormatReader"],c=[],o=!1,r=async()=>{s.muted&&(s.muted=!1),s.play()};return this[d]={codeReader:i,videoDevices:c,isVideoDevicesInit:o,audio:s,playAudio:r},this.displayEleID=e,this.cameraNO=0,this}get isMediaStreamAPISupported(){return navigator&&navigator.mediaDevices&&"enumerateDevices"in navigator.mediaDevices}async getVideoDevices(){return this[d].isVideoDevicesInit||(await navigator.mediaDevices.getUserMedia({video:!0}),await this[d].codeReader.listVideoInputDevices().then((e=>{this[d].videoDevices=e,this[d].isVideoDevicesInit=!0})).catch((e=>{throw console.error(e),e}))),this[d].videoDevices}async scan(){const e=await this.getVideoDevices();if(e&&e.length>0){const t=this.cameraNO<e.length?this.cameraNO:0,a=e[t].deviceId;return this[d].codeReader.decodeFromVideoDevice(a,this.displayEleID,Object(c["b"])((async(e,t)=>{if(e&&(this[d].playAudio(),r.emit("scaned",e)),t&&!(t instanceof n["NotFoundException"]))throw console.error(t),r.emit("scanError",t),t}),1e3))}}async stopScan(){this[d].codeReader.reset()}}var l=h,u={name:"PageIndex",data(){return{scanFlag:!0,scaner:null,canSupport:!1,cameraNO:0,info:"",videoDevices:[],device:null}},destroyed(){r.off("scaned",this.onScaned)},async mounted(){console.info("mounted");const e=new l("video");this.scaner=e,this.canSupport=e.isMediaStreamAPISupported,setTimeout((()=>{e.getVideoDevices().then((e=>this.videoDevices=e))}),50),r.on("scaned",this.onScaned)},methods:{async stopScan(){return this.scaner.stopScan()},async doScan(){return this.scaner.scan()},onScaned(e){console.info(`scan success! value is:${e}`),this.info=e},async switchCamera(){const e=await this.scaner.getVideoDevices();e.length>1&&(await this.scaner.stopScan(),this.scaner.cameraNO=(this.scaner.cameraNO+1)%e.length,this.cameraNO=`${this.scaner.cameraNO}/${e.length}`,await this.scaner.scan())}}},v=u,p=(a("b59b"),a("2877")),m=Object(p["a"])(v,s,i,!1,null,"26c936a6",null);t["default"]=m.exports}}]);