(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[3],{"0d22":function(e,i,t){},"1f3b":function(e,i,t){"use strict";t("0d22")},e344:function(e,i,t){"use strict";t.r(i);var s=function(){var e=this,i=e.$createElement,t=e._self._c||i;return t("q-page",{staticClass:"flex flex-center"},[t("div",{staticClass:"sr__scan__item"},[e.scanFlag?t("video",{ref:"scannerRef",attrs:{id:"video","webkit-playsinline":"true",playsinline:"true"}}):e._e(),t("q-btn",{on:{click:e.doScan}},[e._v(e._s(e.canSupport))]),t("q-select",{attrs:{options:e.videoDevices},model:{value:e.device,callback:function(i){e.device=i},expression:"device"}}),t("q-btn",{on:{click:e.switchCamera}},[e._v(e._s(e.cameraNO))]),t("textarea",{attrs:{cols:100,rows:6},domProps:{value:e.info}})],1)])},n=[],a=(t("e9c4"),t("e01a"),t("224f")),c=t("b178"),o=t("1344"),r=Object(o["a"])();const d=Symbol("privateObj");class l{constructor(e,i={scanVoice:"/scan.mp3"}){const{scanVoice:t}=i,s=new Audio(t),n=new a["BrowserMultiFormatReader"],c=[],o=!1,r=async()=>{s.muted&&(s.muted=!1),s.play()};return this[d]={codeReader:n,videoDevices:c,isVideoDevicesInit:o,audio:s,playAudio:r},this.displayEleID=e,this.cameraNO=0,this}get isMediaStreamAPISupported(){return navigator&&navigator.mediaDevices&&"enumerateDevices"in navigator.mediaDevices}async getVideoDevices(){return this[d].isVideoDevicesInit||await this[d].codeReader.listVideoInputDevices().then((e=>{r.emit("test",e),this[d].videoDevices=e,this[d].isVideoDevicesInit=!0})).catch((e=>{throw console.error(e),e})),this[d].videoDevices}async scan(){const e=await this.getVideoDevices();if(e&&e.length>0){const i=this.cameraNO<e.length?this.cameraNO:0,t=e[i].deviceId;return this[d].codeReader.decodeFromVideoDevice(t,this.displayEleID,Object(c["b"])((async(e,i)=>{if(e&&(this[d].playAudio(),r.emit("scaned",e)),i&&!(i instanceof a["NotFoundException"]))throw console.error(i),r.emit("scanError",i),i}),1e3))}}async stopScan(){this[d].codeReader.reset()}}var h=l,u={name:"PageIndex",data(){return{scanFlag:!0,scaner:null,canSupport:"",cameraNO:0,info:"",videoDevices:[],device:null}},destroyed(){r.off("scaned",this.onScaned)},async mounted(){console.info("mounted");const e=new h("video");this.scaner=e,this.canSupport=e.isMediaStreamAPISupported?"Can Supper Media":"Can't Supper Media",setTimeout((()=>{e.scan().then((()=>e.getVideoDevices())).then((e=>this.videoDevices=e))}),50),r.on("scaned",this.onScaned),r.on("test",(e=>{this.info=this.info.concat(JSON.stringify(e,null,2)).concat("\n")}))},methods:{async doScan(){this.scaner.scan()},onScaned(e){console.info(`scan success! value is:${e}`),this.info=e},async switchCamera(){const e=await this.scaner.getVideoDevices();if(this.info=this.info.concat(JSON.stringify(e,null,2)).concat("\n"),e.length>1)return await this.scaner.stopScan(),this.scaner.cameraNO=(this.scaner.cameraNO+1)%e.length,this.cameraNO=`${this.scaner.cameraNO}/${e.length}`,this.info=this.info.concat(`this.scaner.cameraNO:${this.scaner.cameraNO}`).concat("\n"),this.scaner.scan()}}},v=u,p=(t("1f3b"),t("2877")),m=Object(p["a"])(v,s,n,!1,null,"70e8aed8",null);i["default"]=m.exports}}]);