(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[3],{"9adb":function(e,i,t){},a147:function(e,i,t){"use strict";t("9adb")},e344:function(e,i,t){"use strict";t.r(i);var s=function(){var e=this,i=e.$createElement,t=e._self._c||i;return t("q-page",{staticClass:"flex flex-center"},[t("div",{staticClass:"sr__scan__item"},[e.scanFlag?t("video",{ref:"scannerRef",attrs:{id:"video","webkit-playsinline":"true",playsinline:"true"}}):e._e(),e.canSupport?t("q-btn-group",[t("q-btn",{on:{click:e.doScan}},[e._v("Start Scan")]),t("q-btn",{on:{click:e.stopScan}},[e._v("Stop Scan")]),e.videoDevices.length>1?t("q-btn",{on:{click:e.switchCamera}},[e._v("Switch")]):e._e(),t("q-btn",{on:{click:e.test}},[e._v("test")])],1):e._e(),t("textarea",{attrs:{cols:100,rows:6},domProps:{value:e.info}})],1)])},a=[],n=(t("e9c4"),t("e01a"),t("224f")),c=t("b178"),o=t("1344"),r=Object(o["a"])();const d=Symbol("privateObj");class h{constructor(e,i={scanVoice:"scan.mp3"}){const{scanVoice:t}=i,s=new Audio(t),a=new n["BrowserMultiFormatReader"],c=[],o=!1,h=async()=>{this[d].audio.muted&&(this[d].audio.muted=!1),this[d].audio.play()},l=()=>{const e=this[d].videoDevices.findIndex((e=>"后置镜头"===e.label));return r.emit("test",{mainCamIndex:e,videoDevices:this[d].videoDevices}),e>-1?e:0};return this[d]={codeReader:a,videoDevices:c,isVideoDevicesInit:o,audio:s,playAudio:h,getDefaultDeviceNO:l},this.displayEleID=e,this.cameraNO=-1,this}get isMediaStreamAPISupported(){return navigator&&navigator.mediaDevices&&"enumerateDevices"in navigator.mediaDevices}get isScanning(){return this[d].codeReader.isVideoPlaying(this[d].codeReader.getMediaElement(this.displayEleID,"video"))}async getVideoDevices(){return this[d].isVideoDevicesInit||(await navigator.mediaDevices.getUserMedia({video:!0}),await this[d].codeReader.listVideoInputDevices().then((e=>{this[d].videoDevices=e,this[d].isVideoDevicesInit=!0})).catch((e=>{throw console.error(e),e}))),this[d].videoDevices}async switchCamera(e){const i=await this.getVideoDevices();if(i.length>1){let t=0;t=e?e<i.length?e:this[d].getDefaultDeviceNO():(this.cameraNO+1)%i.length,this.cameraNO!==t&&(this.isScanning&&await this.stopScan(),this.cameraNO=t,await this.scan())}}async scan(){const e=await this.getVideoDevices();if(e&&e.length>0){this.cameraNO=this.cameraNO>-1&&this.cameraNO<e.length?this.cameraNO:this[d].getDefaultDeviceNO();const i=e[this.cameraNO].deviceId;return this[d].codeReader.decodeFromVideoDevice(i,this.displayEleID,Object(c["b"])((async(e,i)=>{if(e&&(this[d].playAudio(),r.emit("scaned",e)),i&&!(i instanceof n["NotFoundException"]))throw console.error(i),r.emit("scanError",i),i}),1e3))}}async stopScan(){this[d].codeReader.reset()}}var l=h,u={name:"PageIndex",data(){return{scanFlag:!0,scaner:null,canSupport:!1,cameraNO:0,info:"",videoDevices:[],device:null,audio:new Audio("scan.mp3")}},destroyed(){r.off("scaned",this.onScaned)},async mounted(){console.info("mounted");const e=new l("video");this.scaner=e,this.canSupport=e.isMediaStreamAPISupported,setTimeout((()=>{e.getVideoDevices().then((e=>this.videoDevices=e))}),50),r.on("scaned",this.onScaned),r.on("test",(e=>this.info=JSON.stringify(e,null,2)))},methods:{async stopScan(){return this.scaner.stopScan()},async doScan(){return this.scaner.scan()},async test(){this.info=this.scaner.isScanning,this.audio.muted&&(this.audio.muted=!1),this.audio.play()},onScaned(e){console.info(`scan success! value is:${e}`),this.info=e},async switchCamera(){this.scaner.switchCamera()}}},v=u,m=(t("a147"),t("2877")),p=Object(m["a"])(v,s,a,!1,null,"4141f7ec",null);i["default"]=p.exports}}]);